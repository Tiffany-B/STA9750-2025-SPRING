<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.40">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Stephanie Jean Baptiste">

<title>Mini Project 4 â€“ STA 9750 Submission Material</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-549806ee2085284f45b00abea8c6df48.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-d34cad7c1ff812d83d3cdf4c9f78cbb4.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<style>html{ scroll-behavior: smooth; }</style>


<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">STA 9750 Submission Material</span>
    </a>
  </div>
        <div class="quarto-navbar-tools tools-end">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Mini Project 4</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Stephanie Jean Baptiste </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<section id="exploring-recent-us-political-shifts" class="level1">
<h1>Exploring Recent US Political Shifts</h1>
<blockquote class="blockquote">
<p>For this project, we collected election result data from 2020 and 2024. The ways in which we imported data from the US Census Bureau, cleaned and formatted data for analysis and extracted datafrom Wikepedia using web scraping</p>
</blockquote>
<p><br><br></p>
<section id="import-the-data-from-the-us-census-bureau---us-county-shapefiles." class="level4">
<h4 class="anchored" data-anchor-id="import-the-data-from-the-us-census-bureau---us-county-shapefiles.">Import the data from the US Census Bureau - US County Shapefiles.</h4>
<blockquote class="blockquote">
<p>For this task we used the <code>sf</code> package to import the shapefiles with the 2nd finest resolution from teh US Census Bureau website. We used the <code>st_read()</code> function to read the shapefiles into R. The shapefiles contain information about the counties in the US, including their names, FIPS codes, and geometry.</p>
</blockquote>
<p><br><br></p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Define the ensure_package function</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a> ensure_package <span class="ot">&lt;-</span> <span class="cf">function</span>(pkg) {</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>   <span class="cf">if</span> (<span class="sc">!</span><span class="fu">requireNamespace</span>(pkg, <span class="at">quietly =</span> <span class="cn">TRUE</span>)) {</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>     <span class="fu">install.packages</span>(pkg)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>   }</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>   <span class="fu">library</span>(pkg, <span class="at">character.only =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a> }</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="co"># # Ensure the necessary packages are installed and loaded</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a> <span class="fu">ensure_package</span>(<span class="st">"dplyr"</span>)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a> <span class="fu">ensure_package</span>(<span class="st">"stringr"</span>)</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a> <span class="fu">ensure_package</span>(<span class="st">"tidyr"</span>)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a> <span class="fu">ensure_package</span>(<span class="st">"httr2"</span>)</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a> <span class="fu">ensure_package</span>(<span class="st">"rvest"</span>)</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a> <span class="fu">ensure_package</span>(<span class="st">"datasets"</span>)</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a> <span class="fu">ensure_package</span>(<span class="st">"purrr"</span>)</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a> <span class="fu">ensure_package</span>(<span class="st">"DT"</span>)</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a> <span class="fu">ensure_package</span>(<span class="st">"jsonlite"</span>)</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a> <span class="fu">ensure_package</span>(<span class="st">"httr"</span>)</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a> <span class="fu">ensure_package</span>(<span class="st">"sf"</span>)</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a> <span class="fu">ensure_package</span>(<span class="st">"tigris"</span>)</span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a> <span class="fu">ensure_package</span>(<span class="st">"kableExtra"</span>)</span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a><span class="co"># # Load the kable package</span></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>load_county_shapefiles <span class="ot">&lt;-</span> <span class="cf">function</span>() {</span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Define file and directory paths</span></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>  directory <span class="ot">&lt;-</span> <span class="st">"data/mp04"</span></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>  file_url <span class="ot">&lt;-</span> <span class="st">"https://www2.census.gov/geo/tiger/GENZ2023/shp/cb_2023_us_county_5m.zip"</span></span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>  zip_path <span class="ot">&lt;-</span> <span class="fu">file.path</span>(directory, <span class="st">"cb_2023_us_county_5m.zip"</span>)</span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>  shapefile_dir <span class="ot">&lt;-</span> <span class="fu">file.path</span>(directory, <span class="st">"shapefiles"</span>)</span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create the directory if it doesn't exist</span></span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">dir.exists</span>(directory)) {</span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a>    <span class="fu">dir.create</span>(directory, <span class="at">recursive =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Download the file if it doesn't already exist</span></span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(zip_path)) {</span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a>    <span class="fu">download.file</span>(file_url, zip_path, <span class="at">mode =</span> <span class="st">"wb"</span>)</span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a>    <span class="fu">message</span>(<span class="st">"File downloaded: "</span>, zip_path)</span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a>    <span class="fu">message</span>(<span class="st">"File already exists: "</span>, zip_path)</span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Unzip only if the .shp file doesn't already exist</span></span>
<span id="cb1-46"><a href="#cb1-46" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(<span class="fu">file.path</span>(shapefile_dir, <span class="st">"cb_2023_us_county_5m.shp"</span>))) {</span>
<span id="cb1-47"><a href="#cb1-47" aria-hidden="true" tabindex="-1"></a>    <span class="fu">unzip</span>(zip_path, <span class="at">exdir =</span> shapefile_dir)</span>
<span id="cb1-48"><a href="#cb1-48" aria-hidden="true" tabindex="-1"></a>    <span class="fu">message</span>(<span class="st">"Unzipped to: "</span>, shapefile_dir)</span>
<span id="cb1-49"><a href="#cb1-49" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1-50"><a href="#cb1-50" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-51"><a href="#cb1-51" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Read the shapefile using sf</span></span>
<span id="cb1-52"><a href="#cb1-52" aria-hidden="true" tabindex="-1"></a>  shapefile_path <span class="ot">&lt;-</span> <span class="fu">file.path</span>(shapefile_dir, <span class="st">"cb_2023_us_county_5m.shp"</span>)</span>
<span id="cb1-53"><a href="#cb1-53" aria-hidden="true" tabindex="-1"></a>  county_shapes <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_read</span>(shapefile_path, <span class="at">quiet =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1-54"><a href="#cb1-54" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-55"><a href="#cb1-55" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(county_shapes)</span>
<span id="cb1-56"><a href="#cb1-56" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-57"><a href="#cb1-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-58"><a href="#cb1-58" aria-hidden="true" tabindex="-1"></a><span class="co"># Call the function</span></span>
<span id="cb1-59"><a href="#cb1-59" aria-hidden="true" tabindex="-1"></a>county_shapefiles <span class="ot">&lt;-</span> <span class="fu">load_county_shapefiles</span>()</span>
<span id="cb1-60"><a href="#cb1-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-61"><a href="#cb1-61" aria-hidden="true" tabindex="-1"></a>county_shapefiles <span class="ot">&lt;-</span> county_shapefiles <span class="sc">|&gt;</span></span>
<span id="cb1-62"><a href="#cb1-62" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="st">`</span><span class="at">County Name</span><span class="st">`</span><span class="ot">=</span> NAME,</span>
<span id="cb1-63"><a href="#cb1-63" aria-hidden="true" tabindex="-1"></a>         <span class="st">`</span><span class="at">Full County Name</span><span class="st">`</span><span class="ot">=</span> NAMELSAD,</span>
<span id="cb1-64"><a href="#cb1-64" aria-hidden="true" tabindex="-1"></a>         <span class="st">`</span><span class="at">State Abbrevation</span><span class="st">`</span> <span class="ot">=</span> STUSPS,</span>
<span id="cb1-65"><a href="#cb1-65" aria-hidden="true" tabindex="-1"></a>         <span class="st">`</span><span class="at">State</span><span class="st">`</span><span class="ot">=</span> STATE_NAME ,</span>
<span id="cb1-66"><a href="#cb1-66" aria-hidden="true" tabindex="-1"></a>         <span class="st">`</span><span class="at">Area Description Code</span><span class="st">`</span><span class="ot">=</span> LSAD ,</span>
<span id="cb1-67"><a href="#cb1-67" aria-hidden="true" tabindex="-1"></a>         <span class="st">`</span><span class="at">Area of Land</span><span class="st">`</span> <span class="ot">=</span> ALAND ,</span>
<span id="cb1-68"><a href="#cb1-68" aria-hidden="true" tabindex="-1"></a>         <span class="st">`</span><span class="at">Area of Water</span><span class="st">`</span> <span class="ot">=</span> AWATER )</span>
<span id="cb1-69"><a href="#cb1-69" aria-hidden="true" tabindex="-1"></a><span class="co">#View the first few rows of the shapefiles</span></span>
<span id="cb1-70"><a href="#cb1-70" aria-hidden="true" tabindex="-1"></a>county_shapefiles <span class="ot">&lt;-</span> county_shapefiles <span class="sc">|&gt;</span></span>
<span id="cb1-71"><a href="#cb1-71" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="st">`</span><span class="at">County Name</span><span class="st">`</span>, <span class="st">`</span><span class="at">Full County Name</span><span class="st">`</span>, <span class="st">`</span><span class="at">State Abbrevation</span><span class="st">`</span>, <span class="st">`</span><span class="at">State</span><span class="st">`</span>, <span class="st">`</span><span class="at">Area Description Code</span><span class="st">`</span>, <span class="st">`</span><span class="at">Area of Land</span><span class="st">`</span>, <span class="st">`</span><span class="at">Area of Water</span><span class="st">`</span>) <span class="sc">|&gt;</span></span>
<span id="cb1-72"><a href="#cb1-72" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_head</span>(<span class="at">n =</span> <span class="dv">10</span>)</span>
<span id="cb1-73"><a href="#cb1-73" aria-hidden="true" tabindex="-1"></a><span class="co">#head(county_shapefiles)</span></span>
<span id="cb1-74"><a href="#cb1-74" aria-hidden="true" tabindex="-1"></a><span class="co">#names(county_shapefiles)</span></span>
<span id="cb1-75"><a href="#cb1-75" aria-hidden="true" tabindex="-1"></a><span class="co">#View(county_shapefiles)</span></span>
<span id="cb1-76"><a href="#cb1-76" aria-hidden="true" tabindex="-1"></a><span class="co">#Create kable of the shapefiles</span></span>
<span id="cb1-77"><a href="#cb1-77" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(county_shapefiles)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 11%">
<col style="width: 16%">
<col style="width: 11%">
<col style="width: 9%">
<col style="width: 13%">
<col style="width: 8%">
<col style="width: 8%">
<col style="width: 19%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">County Name</th>
<th style="text-align: left;">Full County Name</th>
<th style="text-align: left;">State Abbrevation</th>
<th style="text-align: left;">State</th>
<th style="text-align: left;">Area Description Code</th>
<th style="text-align: right;">Area of Land</th>
<th style="text-align: right;">Area of Water</th>
<th style="text-align: left;">geometry</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Clinch</td>
<td style="text-align: left;">Clinch County</td>
<td style="text-align: left;">GA</td>
<td style="text-align: left;">Georgia</td>
<td style="text-align: left;">06</td>
<td style="text-align: right;">2110829178</td>
<td style="text-align: right;">23303279</td>
<td style="text-align: left;">MULTIPOLYGON (((-82.9705 30â€¦</td>
</tr>
<tr class="even">
<td style="text-align: left;">Graves</td>
<td style="text-align: left;">Graves County</td>
<td style="text-align: left;">KY</td>
<td style="text-align: left;">Kentucky</td>
<td style="text-align: left;">06</td>
<td style="text-align: right;">1429042910</td>
<td style="text-align: right;">13030079</td>
<td style="text-align: left;">MULTIPOLYGON (((-88.81724 3â€¦</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Tyrrell</td>
<td style="text-align: left;">Tyrrell County</td>
<td style="text-align: left;">NC</td>
<td style="text-align: left;">North Carolina</td>
<td style="text-align: left;">06</td>
<td style="text-align: right;">1012106670</td>
<td style="text-align: right;">534571696</td>
<td style="text-align: left;">MULTIPOLYGON (((-76.4056 35â€¦</td>
</tr>
<tr class="even">
<td style="text-align: left;">Burke</td>
<td style="text-align: left;">Burke County</td>
<td style="text-align: left;">ND</td>
<td style="text-align: left;">North Dakota</td>
<td style="text-align: left;">06</td>
<td style="text-align: right;">2858360397</td>
<td style="text-align: right;">65734594</td>
<td style="text-align: left;">MULTIPOLYGON (((-102.939 48â€¦</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Harper</td>
<td style="text-align: left;">Harper County</td>
<td style="text-align: left;">OK</td>
<td style="text-align: left;">Oklahoma</td>
<td style="text-align: left;">06</td>
<td style="text-align: right;">2689919590</td>
<td style="text-align: right;">5259447</td>
<td style="text-align: left;">MULTIPOLYGON (((-100.0037 3â€¦</td>
</tr>
<tr class="even">
<td style="text-align: left;">Harlan</td>
<td style="text-align: left;">Harlan County</td>
<td style="text-align: left;">NE</td>
<td style="text-align: left;">Nebraska</td>
<td style="text-align: left;">06</td>
<td style="text-align: right;">1433471190</td>
<td style="text-align: right;">53339808</td>
<td style="text-align: left;">MULTIPOLYGON (((-99.63046 4â€¦</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Blaine</td>
<td style="text-align: left;">Blaine County</td>
<td style="text-align: left;">NE</td>
<td style="text-align: left;">Nebraska</td>
<td style="text-align: left;">06</td>
<td style="text-align: right;">1840709884</td>
<td style="text-align: right;">9415061</td>
<td style="text-align: left;">MULTIPOLYGON (((-100.2676 4â€¦</td>
</tr>
<tr class="even">
<td style="text-align: left;">Lake and Peninsula</td>
<td style="text-align: left;">Lake and Peninsula Borough</td>
<td style="text-align: left;">AK</td>
<td style="text-align: left;">Alaska</td>
<td style="text-align: left;">04</td>
<td style="text-align: right;">61724231553</td>
<td style="text-align: right;">25989628379</td>
<td style="text-align: left;">MULTIPOLYGON (((-157.3261 5â€¦</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Jefferson</td>
<td style="text-align: left;">Jefferson County</td>
<td style="text-align: left;">IL</td>
<td style="text-align: left;">Illinois</td>
<td style="text-align: left;">06</td>
<td style="text-align: right;">1479490501</td>
<td style="text-align: right;">32550293</td>
<td style="text-align: left;">MULTIPOLYGON (((-89.1476 38â€¦</td>
</tr>
<tr class="even">
<td style="text-align: left;">Fulton</td>
<td style="text-align: left;">Fulton County</td>
<td style="text-align: left;">IN</td>
<td style="text-align: left;">Indiana</td>
<td style="text-align: left;">06</td>
<td style="text-align: right;">954133332</td>
<td style="text-align: right;">7439345</td>
<td style="text-align: left;">MULTIPOLYGON (((-86.46851 4â€¦</td>
</tr>
</tbody>
</table>
</div>
</div>
<p><br><br></p>
</section>
<section id="import-the-election-data-from-2024-from-wikipedia" class="level4">
<h4 class="anchored" data-anchor-id="import-the-election-data-from-2024-from-wikipedia">Import the election data from 2024 from Wikipedia</h4>
<blockquote class="blockquote">
<p>Then, we import the election data from 2024 from Wikipedia. The election data contains information about the number of votes cast for each candidate in each county, as well as the total number of votes cast in each county.</p>
</blockquote>
<p><br><br></p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Task 2</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="co">#US 2024 Presidential Election Results</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="do">###########################################################################</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>scrape_state_results <span class="ot">&lt;-</span> <span class="cf">function</span>(state_name) {</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Format the state name into a Wikipedia URL</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>  base_url <span class="ot">&lt;-</span> <span class="st">"https://en.wikipedia.org/wiki"</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>  state_slug <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">" "</span>, <span class="st">"_"</span>, state_name)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Handle special cases like Washington</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>  state_slug <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">case_when</span>(</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>    state_name <span class="sc">==</span> <span class="st">"Washington"</span> <span class="sc">~</span> <span class="st">"Washington_(state)"</span>,</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> <span class="fu">gsub</span>(<span class="st">" "</span>, <span class="st">"_"</span>, state_name)</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>  full_url <span class="ot">&lt;-</span> <span class="fu">paste0</span>(base_url, <span class="st">"/2024_United_States_presidential_election_in_"</span>, state_slug)</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Prepare local HTML cache directory</span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>  html_dir <span class="ot">&lt;-</span> <span class="st">"data/mp04/html"</span></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">dir.exists</span>(html_dir)) <span class="fu">dir.create</span>(html_dir, <span class="at">recursive =</span> <span class="cn">TRUE</span>)</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>  html_file <span class="ot">&lt;-</span> <span class="fu">file.path</span>(html_dir, <span class="fu">paste0</span>(state_slug, <span class="st">".html"</span>))</span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Download and save HTML only if not already cached</span></span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(html_file)) {</span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>    resp <span class="ot">&lt;-</span> <span class="fu">request</span>(full_url) <span class="sc">|&gt;</span> <span class="fu">req_perform</span>()</span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">writeBin</span>(<span class="fu">resp_body_raw</span>(resp), html_file)</span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">message</span>(<span class="st">"Downloaded: "</span>, state_name)</span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">message</span>(<span class="st">"Using cached version for: "</span>, state_name)</span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Load HTML</span></span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a>  page <span class="ot">&lt;-</span> <span class="fu">read_html</span>(html_file)</span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Extract all tables</span></span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a>  tables <span class="ot">&lt;-</span> page <span class="sc">|&gt;</span> <span class="fu">html_elements</span>(<span class="st">"table"</span>)</span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Find the table with "County", "Parish", or "Borough" in column headers</span></span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a>  selected_table <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (tbl <span class="cf">in</span> tables) {</span>
<span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a>    headers <span class="ot">&lt;-</span> tbl <span class="sc">|&gt;</span> <span class="fu">html_elements</span>(<span class="st">"th"</span>) <span class="sc">|&gt;</span> <span class="fu">html_text</span>(<span class="at">trim =</span> <span class="cn">TRUE</span>)</span>
<span id="cb2-39"><a href="#cb2-39" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">any</span>(<span class="fu">grepl</span>(<span class="st">"County|Parish|Borough|Area|Region|District"</span>, headers, <span class="at">ignore.case =</span> <span class="cn">TRUE</span>)))  {</span>
<span id="cb2-40"><a href="#cb2-40" aria-hidden="true" tabindex="-1"></a>      selected_table <span class="ot">&lt;-</span> tbl</span>
<span id="cb2-41"><a href="#cb2-41" aria-hidden="true" tabindex="-1"></a>      <span class="cf">break</span></span>
<span id="cb2-42"><a href="#cb2-42" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb2-43"><a href="#cb2-43" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb2-44"><a href="#cb2-44" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-45"><a href="#cb2-45" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Return NULL if no table found</span></span>
<span id="cb2-46"><a href="#cb2-46" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">is.null</span>(selected_table)) {</span>
<span id="cb2-47"><a href="#cb2-47" aria-hidden="true" tabindex="-1"></a>    <span class="fu">warning</span>(<span class="st">"No county-level table found for: "</span>, state_name)</span>
<span id="cb2-48"><a href="#cb2-48" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="cn">NULL</span>)</span>
<span id="cb2-49"><a href="#cb2-49" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb2-50"><a href="#cb2-50" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-51"><a href="#cb2-51" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Convert to data frame and clean</span></span>
<span id="cb2-52"><a href="#cb2-52" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> selected_table <span class="sc">|&gt;</span></span>
<span id="cb2-53"><a href="#cb2-53" aria-hidden="true" tabindex="-1"></a>    <span class="fu">html_table</span>(<span class="at">fill =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span></span>
<span id="cb2-54"><a href="#cb2-54" aria-hidden="true" tabindex="-1"></a>    janitor<span class="sc">::</span><span class="fu">clean_names</span>() <span class="sc">|&gt;</span></span>
<span id="cb2-55"><a href="#cb2-55" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">state =</span> state_name)</span>
<span id="cb2-56"><a href="#cb2-56" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb2-57"><a href="#cb2-57" aria-hidden="true" tabindex="-1"></a>  <span class="co"># # Standardize column types to avoid bind_rows issues</span></span>
<span id="cb2-58"><a href="#cb2-58" aria-hidden="true" tabindex="-1"></a>   df <span class="ot">&lt;-</span> df <span class="sc">|&gt;</span></span>
<span id="cb2-59"><a href="#cb2-59" aria-hidden="true" tabindex="-1"></a>     <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">everything</span>(), as.character))  <span class="co"># Convert all columns to character type</span></span>
<span id="cb2-60"><a href="#cb2-60" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-61"><a href="#cb2-61" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(df)</span>
<span id="cb2-62"><a href="#cb2-62" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-63"><a href="#cb2-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-64"><a href="#cb2-64" aria-hidden="true" tabindex="-1"></a>us_states <span class="ot">&lt;-</span> state.name</span>
<span id="cb2-65"><a href="#cb2-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-66"><a href="#cb2-66" aria-hidden="true" tabindex="-1"></a><span class="co"># Safely attempt scraping for all states</span></span>
<span id="cb2-67"><a href="#cb2-67" aria-hidden="true" tabindex="-1"></a>all_election_results <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map_dfr</span>(us_states, <span class="sc">~</span>{</span>
<span id="cb2-68"><a href="#cb2-68" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tryCatch</span>(<span class="fu">scrape_state_results</span>(.x), <span class="at">error =</span> <span class="cf">function</span>(e) {</span>
<span id="cb2-69"><a href="#cb2-69" aria-hidden="true" tabindex="-1"></a>    <span class="fu">message</span>(<span class="st">"Error scraping "</span>, .x, <span class="st">": "</span>, e<span class="sc">$</span>message)</span>
<span id="cb2-70"><a href="#cb2-70" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="cn">NULL</span>)</span>
<span id="cb2-71"><a href="#cb2-71" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb2-72"><a href="#cb2-72" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb2-73"><a href="#cb2-73" aria-hidden="true" tabindex="-1"></a><span class="co"># View the first few rows of the combined data frame</span></span>
<span id="cb2-74"><a href="#cb2-74" aria-hidden="true" tabindex="-1"></a><span class="co">#head(all_election_results)</span></span>
<span id="cb2-75"><a href="#cb2-75" aria-hidden="true" tabindex="-1"></a><span class="co">#sum(!is.null(all_election_results))</span></span>
<span id="cb2-76"><a href="#cb2-76" aria-hidden="true" tabindex="-1"></a><span class="co">#names(all_election_results)</span></span>
<span id="cb2-77"><a href="#cb2-77" aria-hidden="true" tabindex="-1"></a><span class="co">#View(all_election_results)</span></span>
<span id="cb2-78"><a href="#cb2-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-79"><a href="#cb2-79" aria-hidden="true" tabindex="-1"></a>cleaned_results <span class="ot">&lt;-</span> all_election_results <span class="sc">|&gt;</span></span>
<span id="cb2-80"><a href="#cb2-80" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(county)) <span class="sc">|&gt;</span></span>
<span id="cb2-81"><a href="#cb2-81" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(county, donald_trump_republican, kamala_harris_democratic, margin, total, state, various_candidates_other_parties)</span>
<span id="cb2-82"><a href="#cb2-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-83"><a href="#cb2-83" aria-hidden="true" tabindex="-1"></a>cleaned_results <span class="ot">&lt;-</span> cleaned_results[<span class="sc">-</span><span class="dv">1</span>,] </span>
<span id="cb2-84"><a href="#cb2-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-85"><a href="#cb2-85" aria-hidden="true" tabindex="-1"></a><span class="co">#rename selected columns in cleaned_results</span></span>
<span id="cb2-86"><a href="#cb2-86" aria-hidden="true" tabindex="-1"></a>US_2024_Election_Results <span class="ot">&lt;-</span> cleaned_results <span class="sc">|&gt;</span></span>
<span id="cb2-87"><a href="#cb2-87" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="st">`</span><span class="at">County Name</span><span class="st">`</span> <span class="ot">=</span> county,</span>
<span id="cb2-88"><a href="#cb2-88" aria-hidden="true" tabindex="-1"></a>         <span class="st">`</span><span class="at">Donald Trump (Republican) 2024</span><span class="st">`</span> <span class="ot">=</span> donald_trump_republican,</span>
<span id="cb2-89"><a href="#cb2-89" aria-hidden="true" tabindex="-1"></a>         <span class="st">`</span><span class="at">Kamala Harris (Democratic) 2024</span><span class="st">`</span> <span class="ot">=</span> kamala_harris_democratic,</span>
<span id="cb2-90"><a href="#cb2-90" aria-hidden="true" tabindex="-1"></a>         <span class="st">`</span><span class="at">Margin 2024</span><span class="st">`</span> <span class="ot">=</span> margin,</span>
<span id="cb2-91"><a href="#cb2-91" aria-hidden="true" tabindex="-1"></a>         <span class="st">`</span><span class="at">Total Votes Cast 2024</span><span class="st">`</span> <span class="ot">=</span> total,</span>
<span id="cb2-92"><a href="#cb2-92" aria-hidden="true" tabindex="-1"></a>         <span class="st">`</span><span class="at">State</span><span class="st">`</span> <span class="ot">=</span> state,</span>
<span id="cb2-93"><a href="#cb2-93" aria-hidden="true" tabindex="-1"></a>         <span class="st">`</span><span class="at">Various Candidates (Other Parties) 2024</span><span class="st">`</span> <span class="ot">=</span> various_candidates_other_parties)</span>
<span id="cb2-94"><a href="#cb2-94" aria-hidden="true" tabindex="-1"></a><span class="co">#View the first few rows of the cleaned results</span></span>
<span id="cb2-95"><a href="#cb2-95" aria-hidden="true" tabindex="-1"></a>US_2024_Election_Results <span class="ot">&lt;-</span> US_2024_Election_Results <span class="sc">|&gt;</span></span>
<span id="cb2-96"><a href="#cb2-96" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="st">`</span><span class="at">County Name</span><span class="st">`</span>, <span class="st">`</span><span class="at">Donald Trump (Republican) 2024</span><span class="st">`</span>, <span class="st">`</span><span class="at">Kamala Harris (Democratic) 2024</span><span class="st">`</span>, <span class="st">`</span><span class="at">Margin 2024</span><span class="st">`</span>, <span class="st">`</span><span class="at">Total Votes Cast 2024</span><span class="st">`</span>, <span class="st">`</span><span class="at">State</span><span class="st">`</span>, <span class="st">`</span><span class="at">Various Candidates (Other Parties) 2024</span><span class="st">`</span>) <span class="sc">|&gt;</span></span>
<span id="cb2-97"><a href="#cb2-97" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_head</span>(<span class="at">n =</span> <span class="dv">10</span>)</span>
<span id="cb2-98"><a href="#cb2-98" aria-hidden="true" tabindex="-1"></a><span class="co">#View(US_2024_Election_Results)</span></span>
<span id="cb2-99"><a href="#cb2-99" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(US_2024_Election_Results)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 7%">
<col style="width: 19%">
<col style="width: 20%">
<col style="width: 7%">
<col style="width: 14%">
<col style="width: 5%">
<col style="width: 25%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">County Name</th>
<th style="text-align: left;">Donald Trump (Republican) 2024</th>
<th style="text-align: left;">Kamala Harris (Democratic) 2024</th>
<th style="text-align: left;">Margin 2024</th>
<th style="text-align: left;">Total Votes Cast 2024</th>
<th style="text-align: left;">State</th>
<th style="text-align: left;">Various Candidates (Other Parties) 2024</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Autauga</td>
<td style="text-align: left;">20,484</td>
<td style="text-align: left;">7,439</td>
<td style="text-align: left;">13,045</td>
<td style="text-align: left;">28,281</td>
<td style="text-align: left;">Alabama</td>
<td style="text-align: left;">358</td>
</tr>
<tr class="even">
<td style="text-align: left;">Baldwin</td>
<td style="text-align: left;">95,798</td>
<td style="text-align: left;">24,934</td>
<td style="text-align: left;">70,864</td>
<td style="text-align: left;">122,249</td>
<td style="text-align: left;">Alabama</td>
<td style="text-align: left;">1,517</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Barbour</td>
<td style="text-align: left;">5,606</td>
<td style="text-align: left;">4,158</td>
<td style="text-align: left;">1,448</td>
<td style="text-align: left;">9,855</td>
<td style="text-align: left;">Alabama</td>
<td style="text-align: left;">91</td>
</tr>
<tr class="even">
<td style="text-align: left;">Bibb</td>
<td style="text-align: left;">7,572</td>
<td style="text-align: left;">1,619</td>
<td style="text-align: left;">5,953</td>
<td style="text-align: left;">9,257</td>
<td style="text-align: left;">Alabama</td>
<td style="text-align: left;">66</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Blount</td>
<td style="text-align: left;">25,354</td>
<td style="text-align: left;">2,576</td>
<td style="text-align: left;">22,778</td>
<td style="text-align: left;">28,163</td>
<td style="text-align: left;">Alabama</td>
<td style="text-align: left;">233</td>
</tr>
<tr class="even">
<td style="text-align: left;">Bullock</td>
<td style="text-align: left;">1,101</td>
<td style="text-align: left;">2,983</td>
<td style="text-align: left;">-1,882</td>
<td style="text-align: left;">4,111</td>
<td style="text-align: left;">Alabama</td>
<td style="text-align: left;">27</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Butler</td>
<td style="text-align: left;">5,172</td>
<td style="text-align: left;">3,251</td>
<td style="text-align: left;">1,921</td>
<td style="text-align: left;">8,480</td>
<td style="text-align: left;">Alabama</td>
<td style="text-align: left;">57</td>
</tr>
<tr class="even">
<td style="text-align: left;">Calhoun</td>
<td style="text-align: left;">34,912</td>
<td style="text-align: left;">13,194</td>
<td style="text-align: left;">21,718</td>
<td style="text-align: left;">48,653</td>
<td style="text-align: left;">Alabama</td>
<td style="text-align: left;">547</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Chambers</td>
<td style="text-align: left;">8,711</td>
<td style="text-align: left;">5,405</td>
<td style="text-align: left;">3,306</td>
<td style="text-align: left;">14,245</td>
<td style="text-align: left;">Alabama</td>
<td style="text-align: left;">129</td>
</tr>
<tr class="even">
<td style="text-align: left;">Cherokee</td>
<td style="text-align: left;">11,358</td>
<td style="text-align: left;">1,553</td>
<td style="text-align: left;">9,805</td>
<td style="text-align: left;">13,006</td>
<td style="text-align: left;">Alabama</td>
<td style="text-align: left;">95</td>
</tr>
</tbody>
</table>
</div>
</div>
<p><br><br></p>
</section>
<section id="import-the-election-data-from-2020-from-wikipedia" class="level4">
<h4 class="anchored" data-anchor-id="import-the-election-data-from-2020-from-wikipedia">Import the election data from 2020 from Wikipedia</h4>
<blockquote class="blockquote">
<p>Lastly, we import the election data from 2020 from Wikipedia. The election data contains information about the number of votes cast for each candidate in each county, as well as the total number of votes cast in each county.</p>
</blockquote>
<p><br><br></p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Task 3: Acquire 2020 US Presidential Election Results</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="do">#########################################################################################################</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>scrape_state_results_2020 <span class="ot">&lt;-</span> <span class="cf">function</span>(state_name) {</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Format the state name into a Wikipedia URL</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>  base_url <span class="ot">&lt;-</span> <span class="st">"https://en.wikipedia.org/wiki"</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>  state_slug <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">" "</span>, <span class="st">"_"</span>, state_name)</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Handle special cases like Washington</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>  state_slug <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">case_when</span>(</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>    state_name <span class="sc">==</span> <span class="st">"Washington"</span> <span class="sc">~</span> <span class="st">"Washington_(state)"</span>,</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> <span class="fu">gsub</span>(<span class="st">" "</span>, <span class="st">"_"</span>, state_name)</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>  full_url <span class="ot">&lt;-</span> <span class="fu">paste0</span>(base_url, <span class="st">"/2020_United_States_presidential_election_in_"</span>, state_slug)</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Prepare local HTML cache directory</span></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>  html_dir <span class="ot">&lt;-</span> <span class="st">"data/mp04/html_2020"</span></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">dir.exists</span>(html_dir)) <span class="fu">dir.create</span>(html_dir, <span class="at">recursive =</span> <span class="cn">TRUE</span>)</span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>  html_file <span class="ot">&lt;-</span> <span class="fu">file.path</span>(html_dir, <span class="fu">paste0</span>(state_slug, <span class="st">".html"</span>))</span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Download and save HTML only if not already cached</span></span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(html_file)) {</span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>    resp <span class="ot">&lt;-</span> <span class="fu">request</span>(full_url) <span class="sc">|&gt;</span> <span class="fu">req_perform</span>()</span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">writeBin</span>(<span class="fu">resp_body_raw</span>(resp), html_file)</span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">message</span>(<span class="st">"Downloaded: "</span>, state_name)</span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">message</span>(<span class="st">"Using cached version for: "</span>, state_name)</span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Load HTML</span></span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a>  page <span class="ot">&lt;-</span> <span class="fu">read_html</span>(html_file)</span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Extract all tables</span></span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a>  tables <span class="ot">&lt;-</span> page <span class="sc">|&gt;</span> <span class="fu">html_elements</span>(<span class="st">"table"</span>)</span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Find the table with "County", "Parish", or "Borough" in column headers</span></span>
<span id="cb3-35"><a href="#cb3-35" aria-hidden="true" tabindex="-1"></a>  selected_table <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb3-36"><a href="#cb3-36" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (tbl <span class="cf">in</span> tables) {</span>
<span id="cb3-37"><a href="#cb3-37" aria-hidden="true" tabindex="-1"></a>    headers <span class="ot">&lt;-</span> tbl <span class="sc">|&gt;</span> <span class="fu">html_elements</span>(<span class="st">"th"</span>) <span class="sc">|&gt;</span> <span class="fu">html_text</span>(<span class="at">trim =</span> <span class="cn">TRUE</span>)</span>
<span id="cb3-38"><a href="#cb3-38" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">any</span>(<span class="fu">grepl</span>(<span class="st">"County|Parish|Borough|Area|Region|District"</span>, headers, <span class="at">ignore.case =</span> <span class="cn">TRUE</span>)))  {</span>
<span id="cb3-39"><a href="#cb3-39" aria-hidden="true" tabindex="-1"></a>      selected_table <span class="ot">&lt;-</span> tbl</span>
<span id="cb3-40"><a href="#cb3-40" aria-hidden="true" tabindex="-1"></a>      <span class="cf">break</span></span>
<span id="cb3-41"><a href="#cb3-41" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb3-42"><a href="#cb3-42" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb3-43"><a href="#cb3-43" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-44"><a href="#cb3-44" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">is.null</span>(selected_table)) {</span>
<span id="cb3-45"><a href="#cb3-45" aria-hidden="true" tabindex="-1"></a>    <span class="fu">warning</span>(<span class="st">"No county-level table found for: "</span>, state_name)</span>
<span id="cb3-46"><a href="#cb3-46" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="cn">NULL</span>)</span>
<span id="cb3-47"><a href="#cb3-47" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb3-48"><a href="#cb3-48" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-49"><a href="#cb3-49" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Convert to data frame and clean</span></span>
<span id="cb3-50"><a href="#cb3-50" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> selected_table <span class="sc">|&gt;</span></span>
<span id="cb3-51"><a href="#cb3-51" aria-hidden="true" tabindex="-1"></a>    <span class="fu">html_table</span>(<span class="at">fill =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span></span>
<span id="cb3-52"><a href="#cb3-52" aria-hidden="true" tabindex="-1"></a>    janitor<span class="sc">::</span><span class="fu">clean_names</span>() <span class="sc">|&gt;</span></span>
<span id="cb3-53"><a href="#cb3-53" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">state =</span> state_name) <span class="sc">|&gt;</span></span>
<span id="cb3-54"><a href="#cb3-54" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">everything</span>(), as.character))</span>
<span id="cb3-55"><a href="#cb3-55" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-56"><a href="#cb3-56" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(df)</span>
<span id="cb3-57"><a href="#cb3-57" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb3-58"><a href="#cb3-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-59"><a href="#cb3-59" aria-hidden="true" tabindex="-1"></a>us_states <span class="ot">&lt;-</span> state.name</span>
<span id="cb3-60"><a href="#cb3-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-61"><a href="#cb3-61" aria-hidden="true" tabindex="-1"></a>all_election_results_2020 <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map_dfr</span>(us_states, <span class="sc">~</span>{</span>
<span id="cb3-62"><a href="#cb3-62" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tryCatch</span>(<span class="fu">scrape_state_results_2020</span>(.x), <span class="at">error =</span> <span class="cf">function</span>(e) {</span>
<span id="cb3-63"><a href="#cb3-63" aria-hidden="true" tabindex="-1"></a>    <span class="fu">message</span>(<span class="st">"Error scraping "</span>, .x, <span class="st">": "</span>, e<span class="sc">$</span>message)</span>
<span id="cb3-64"><a href="#cb3-64" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="cn">NULL</span>)</span>
<span id="cb3-65"><a href="#cb3-65" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb3-66"><a href="#cb3-66" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb3-67"><a href="#cb3-67" aria-hidden="true" tabindex="-1"></a><span class="co">#head(all_election_results_2020)</span></span>
<span id="cb3-68"><a href="#cb3-68" aria-hidden="true" tabindex="-1"></a><span class="co">#names(all_election_results_2020)</span></span>
<span id="cb3-69"><a href="#cb3-69" aria-hidden="true" tabindex="-1"></a><span class="co">#View(all_election_results_2020)</span></span>
<span id="cb3-70"><a href="#cb3-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-71"><a href="#cb3-71" aria-hidden="true" tabindex="-1"></a><span class="co">#Create a kable table of the election results</span></span>
<span id="cb3-72"><a href="#cb3-72" aria-hidden="true" tabindex="-1"></a><span class="co">#kable(all_election_results_2020)</span></span>
<span id="cb3-73"><a href="#cb3-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-74"><a href="#cb3-74" aria-hidden="true" tabindex="-1"></a>cleaned_results_2020 <span class="ot">&lt;-</span> all_election_results_2020 <span class="sc">|&gt;</span></span>
<span id="cb3-75"><a href="#cb3-75" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(county)) <span class="sc">|&gt;</span></span>
<span id="cb3-76"><a href="#cb3-76" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(county, donald_trump_republican, joe_biden_democratic, margin, total, state, various_candidates_other_parties)</span>
<span id="cb3-77"><a href="#cb3-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-78"><a href="#cb3-78" aria-hidden="true" tabindex="-1"></a>cleaned_results_2020 <span class="ot">&lt;-</span> cleaned_results_2020[<span class="sc">-</span><span class="dv">1</span>,]</span>
<span id="cb3-79"><a href="#cb3-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-80"><a href="#cb3-80" aria-hidden="true" tabindex="-1"></a><span class="co">#rename selected columns in cleaned_results</span></span>
<span id="cb3-81"><a href="#cb3-81" aria-hidden="true" tabindex="-1"></a>US_2020_Election_Results <span class="ot">&lt;-</span> cleaned_results_2020 <span class="sc">|&gt;</span></span>
<span id="cb3-82"><a href="#cb3-82" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="st">`</span><span class="at">County Name</span><span class="st">`</span> <span class="ot">=</span> county,</span>
<span id="cb3-83"><a href="#cb3-83" aria-hidden="true" tabindex="-1"></a>         <span class="st">`</span><span class="at">Donald Trump (Republican) 2020</span><span class="st">`</span> <span class="ot">=</span> donald_trump_republican,</span>
<span id="cb3-84"><a href="#cb3-84" aria-hidden="true" tabindex="-1"></a>         <span class="st">`</span><span class="at">Joe Biden (Democratic) 2020</span><span class="st">`</span> <span class="ot">=</span> joe_biden_democratic,</span>
<span id="cb3-85"><a href="#cb3-85" aria-hidden="true" tabindex="-1"></a>         <span class="st">`</span><span class="at">Margin 2020</span><span class="st">`</span> <span class="ot">=</span> margin,</span>
<span id="cb3-86"><a href="#cb3-86" aria-hidden="true" tabindex="-1"></a>         <span class="st">`</span><span class="at">Total Votes Cast 2020</span><span class="st">`</span> <span class="ot">=</span> total,</span>
<span id="cb3-87"><a href="#cb3-87" aria-hidden="true" tabindex="-1"></a>         <span class="st">`</span><span class="at">State</span><span class="st">`</span> <span class="ot">=</span> state,</span>
<span id="cb3-88"><a href="#cb3-88" aria-hidden="true" tabindex="-1"></a>         <span class="st">`</span><span class="at">Various Candidates (Other Parties) 2020</span><span class="st">`</span> <span class="ot">=</span> various_candidates_other_parties)</span>
<span id="cb3-89"><a href="#cb3-89" aria-hidden="true" tabindex="-1"></a><span class="co">#View the first few rows of the cleaned results</span></span>
<span id="cb3-90"><a href="#cb3-90" aria-hidden="true" tabindex="-1"></a>US_2020_Election_Results <span class="ot">&lt;-</span> US_2020_Election_Results <span class="sc">|&gt;</span></span>
<span id="cb3-91"><a href="#cb3-91" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="st">`</span><span class="at">County Name</span><span class="st">`</span>, <span class="st">`</span><span class="at">Donald Trump (Republican) 2020</span><span class="st">`</span>, <span class="st">`</span><span class="at">Joe Biden (Democratic) 2020</span><span class="st">`</span>, <span class="st">`</span><span class="at">Margin 2020</span><span class="st">`</span>, <span class="st">`</span><span class="at">Total Votes Cast 2020</span><span class="st">`</span>, <span class="st">`</span><span class="at">State</span><span class="st">`</span>, <span class="st">`</span><span class="at">Various Candidates (Other Parties) 2020</span><span class="st">`</span>) <span class="sc">|&gt;</span></span>
<span id="cb3-92"><a href="#cb3-92" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_head</span>(<span class="at">n =</span> <span class="dv">10</span>)</span>
<span id="cb3-93"><a href="#cb3-93" aria-hidden="true" tabindex="-1"></a><span class="co">#View(US_2020_Election_Results)</span></span>
<span id="cb3-94"><a href="#cb3-94" aria-hidden="true" tabindex="-1"></a><span class="co">#Create a kable table of the election results</span></span>
<span id="cb3-95"><a href="#cb3-95" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(US_2020_Election_Results)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 7%">
<col style="width: 20%">
<col style="width: 18%">
<col style="width: 7%">
<col style="width: 14%">
<col style="width: 5%">
<col style="width: 26%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">County Name</th>
<th style="text-align: left;">Donald Trump (Republican) 2020</th>
<th style="text-align: left;">Joe Biden (Democratic) 2020</th>
<th style="text-align: left;">Margin 2020</th>
<th style="text-align: left;">Total Votes Cast 2020</th>
<th style="text-align: left;">State</th>
<th style="text-align: left;">Various Candidates (Other Parties) 2020</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Autauga</td>
<td style="text-align: left;">19,838</td>
<td style="text-align: left;">7,503</td>
<td style="text-align: left;">12,335</td>
<td style="text-align: left;">27,770</td>
<td style="text-align: left;">Alabama</td>
<td style="text-align: left;">429</td>
</tr>
<tr class="even">
<td style="text-align: left;">Baldwin</td>
<td style="text-align: left;">83,544</td>
<td style="text-align: left;">24,578</td>
<td style="text-align: left;">58,966</td>
<td style="text-align: left;">109,679</td>
<td style="text-align: left;">Alabama</td>
<td style="text-align: left;">1,557</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Barbour</td>
<td style="text-align: left;">5,622</td>
<td style="text-align: left;">4,816</td>
<td style="text-align: left;">806</td>
<td style="text-align: left;">10,518</td>
<td style="text-align: left;">Alabama</td>
<td style="text-align: left;">80</td>
</tr>
<tr class="even">
<td style="text-align: left;">Bibb</td>
<td style="text-align: left;">7,525</td>
<td style="text-align: left;">1,986</td>
<td style="text-align: left;">5,539</td>
<td style="text-align: left;">9,595</td>
<td style="text-align: left;">Alabama</td>
<td style="text-align: left;">84</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Blount</td>
<td style="text-align: left;">24,711</td>
<td style="text-align: left;">2,640</td>
<td style="text-align: left;">22,071</td>
<td style="text-align: left;">27,588</td>
<td style="text-align: left;">Alabama</td>
<td style="text-align: left;">237</td>
</tr>
<tr class="even">
<td style="text-align: left;">Bullock</td>
<td style="text-align: left;">1,146</td>
<td style="text-align: left;">3,446</td>
<td style="text-align: left;">-2,300</td>
<td style="text-align: left;">4,613</td>
<td style="text-align: left;">Alabama</td>
<td style="text-align: left;">21</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Butler</td>
<td style="text-align: left;">5,458</td>
<td style="text-align: left;">3,965</td>
<td style="text-align: left;">1,493</td>
<td style="text-align: left;">9,488</td>
<td style="text-align: left;">Alabama</td>
<td style="text-align: left;">65</td>
</tr>
<tr class="even">
<td style="text-align: left;">Calhoun</td>
<td style="text-align: left;">35,101</td>
<td style="text-align: left;">15,216</td>
<td style="text-align: left;">19,885</td>
<td style="text-align: left;">50,983</td>
<td style="text-align: left;">Alabama</td>
<td style="text-align: left;">666</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Chambers</td>
<td style="text-align: left;">8,753</td>
<td style="text-align: left;">6,365</td>
<td style="text-align: left;">2,388</td>
<td style="text-align: left;">15,284</td>
<td style="text-align: left;">Alabama</td>
<td style="text-align: left;">166</td>
</tr>
<tr class="even">
<td style="text-align: left;">Cherokee</td>
<td style="text-align: left;">10,583</td>
<td style="text-align: left;">1,624</td>
<td style="text-align: left;">8,959</td>
<td style="text-align: left;">12,301</td>
<td style="text-align: left;">Alabama</td>
<td style="text-align: left;">94</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="initial-analysis-questions" class="level2">
<h2 class="anchored" data-anchor-id="initial-analysis-questions">Initial Analysis Questions</h2>
<p><br><br></p>
<section id="merging-the-county-shapefiles-us-2024-election-results-and-us-2020-election-results" class="level4">
<h4 class="anchored" data-anchor-id="merging-the-county-shapefiles-us-2024-election-results-and-us-2020-election-results">Merging the County Shapefiles, US 2024 Election Results and US 2020 Election Results</h4>
<blockquote class="blockquote">
<p>First, we merge the dataframes for analysis of the election results as a whole. We will use the <code>inner_join</code> function from the <code>dplyr</code> package to merge the dataframes. The <code>inner_join</code> function will keep only the rows that have matching values in both dataframes. This is important because we want to analyze only the counties that are present in both election years.</p>
</blockquote>
<p><br><br></p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Join the dataframes county_shapefiles, US_2024_Election_Results, and US_2020_Election_Results</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="co"># to create a single dataframe that contains all the information you need for analysis.</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="co"># # Use the `inner_join` function from dplyr to merge the dataframes</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="co">#names(county_shapefiles)</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="co">#names(US_2024_Election_Results)</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="co">#names(US_2020_Election_Results)</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>merged_data <span class="ot">&lt;-</span> US_2024_Election_Results <span class="sc">|&gt;</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(US_2020_Election_Results, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"County Name"</span>,<span class="st">"State"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(county_shapefiles, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"County Name"</span>,<span class="st">"State"</span>))</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a><span class="co"># View the first few rows of the merged data</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a><span class="co">#View(merged_data)</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a><span class="co">#names(merged_data)</span></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a kable table of the merged data</span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a><span class="co">#kable(merged_data) </span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><br><br></p>
<section id="which-county-or-counties-cast-the-most-votes-for-trump-in-absolute-terms-in-2024" class="level5">
<h5 class="anchored" data-anchor-id="which-county-or-counties-cast-the-most-votes-for-trump-in-absolute-terms-in-2024">Which county or counties cast the most votes for Trump (in absolute terms) in 2024?</h5>
<blockquote class="blockquote">
<p>The most votes for Trump is defined as the total number of votes cast for Trump in 2024. We will calculate this for each county and then find the top ten counties with the highest values.</p>
</blockquote>
<p><br><br></p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 1: Convert Trump 2024 vote column to numeric</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>trump_votes <span class="ot">&lt;-</span> merged_data <span class="sc">|&gt;</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="st">`</span><span class="at">Donald Trump (Republican) 2024</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">as.numeric</span>(<span class="fu">gsub</span>(<span class="st">","</span>, <span class="st">""</span>, <span class="st">`</span><span class="at">Donald Trump (Republican) 2024</span><span class="st">`</span>)))</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 2: Find the maximum number of Trump votes</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>top10_trump_votes <span class="ot">&lt;-</span> trump_votes <span class="sc">|&gt;</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(<span class="st">`</span><span class="at">Donald Trump (Republican) 2024</span><span class="st">`</span>)) <span class="sc">|&gt;</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_head</span>(<span class="at">n =</span> <span class="dv">10</span>) <span class="sc">|&gt;</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="st">`</span><span class="at">County Name</span><span class="st">`</span>, State, <span class="st">`</span><span class="at">Donald Trump (Republican) 2024</span><span class="st">`</span>)</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>  <span class="co">#summarise(max_votes = max(`Donald Trump (Republican) 2024`, na.rm = TRUE))</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a><span class="co"># # Step 3: Filter rows where Trump got that max number of votes</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a><span class="co"># largest_trump_votes_2024 &lt;- largest_trump_votes_2024 |&gt;</span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a><span class="co">#   filter(`Donald Trump (Republican) 2024` == max_trump_votes$max_votes) |&gt;</span></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a><span class="co">#   select(`County Name`, State, `Donald Trump (Republican) 2024`)</span></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a><span class="co"># View the result</span></span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a><span class="co">#View(top10_trump_votes)</span></span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a><span class="co">#create a kable table of the top 10 counties</span></span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(top10_trump_votes)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">County Name</th>
<th style="text-align: left;">State</th>
<th style="text-align: right;">Donald Trump (Republican) 2024</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Harris</td>
<td style="text-align: left;">Texas</td>
<td style="text-align: right;">722695</td>
</tr>
<tr class="even">
<td style="text-align: left;">Tarrant</td>
<td style="text-align: left;">Texas</td>
<td style="text-align: right;">426626</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Oakland</td>
<td style="text-align: left;">Michigan</td>
<td style="text-align: right;">337791</td>
</tr>
<tr class="even">
<td style="text-align: left;">Bexar</td>
<td style="text-align: left;">Texas</td>
<td style="text-align: right;">337545</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Dallas</td>
<td style="text-align: left;">Texas</td>
<td style="text-align: right;">322569</td>
</tr>
<tr class="even">
<td style="text-align: left;">Wayne</td>
<td style="text-align: left;">Michigan</td>
<td style="text-align: right;">288860</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Macomb</td>
<td style="text-align: left;">Michigan</td>
<td style="text-align: right;">284660</td>
</tr>
<tr class="even">
<td style="text-align: left;">Collin</td>
<td style="text-align: left;">Texas</td>
<td style="text-align: right;">279534</td>
</tr>
<tr class="odd">
<td style="text-align: left;">King</td>
<td style="text-align: left;">Washington</td>
<td style="text-align: right;">252193</td>
</tr>
<tr class="even">
<td style="text-align: left;">Denton</td>
<td style="text-align: left;">Texas</td>
<td style="text-align: right;">250521</td>
</tr>
</tbody>
</table>
</div>
</div>
<p><br><br></p>
</section>
<section id="which-county-or-counties-cast-the-most-votes-for-biden-as-a-fraction-of-total-votes-cast-in-2020" class="level5">
<h5 class="anchored" data-anchor-id="which-county-or-counties-cast-the-most-votes-for-biden-as-a-fraction-of-total-votes-cast-in-2020">Which county or counties cast the most votes for Biden (as a fraction of total votes cast) in 2020?</h5>
<blockquote class="blockquote">
<p>The most votes for Biden is defined as the total number of votes cast for Biden in 2020 divided by the total number of votes cast in 2020. We will calculate this for each county and then find the top ten counties with the highest values.</p>
</blockquote>
<p><br><br></p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Which county or counties cast the most votes for Biden (as a fraction of total votes cast) in 2020?</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readr)</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>top_10_biden_fraction <span class="ot">&lt;-</span> merged_data <span class="sc">|&gt;</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Biden Votes</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">parse_number</span>(<span class="st">`</span><span class="at">Joe Biden (Democratic) 2020</span><span class="st">`</span>),</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Total Votes</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">parse_number</span>(<span class="st">`</span><span class="at">Total Votes Cast 2020</span><span class="st">`</span>),</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Fraction of Votes for Biden</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">round</span>(<span class="st">`</span><span class="at">Biden Votes</span><span class="st">`</span> <span class="sc">/</span> <span class="st">`</span><span class="at">Total Votes</span><span class="st">`</span>,<span class="dv">3</span>)</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(<span class="st">`</span><span class="at">Fraction of Votes for Biden</span><span class="st">`</span>)) <span class="sc">|&gt;</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(<span class="st">`</span><span class="at">Fraction of Votes for Biden</span><span class="st">`</span>)) <span class="sc">|&gt;</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_head</span>(<span class="at">n =</span> <span class="dv">10</span>) <span class="sc">|&gt;</span></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="st">`</span><span class="at">County Name</span><span class="st">`</span>, State, <span class="st">`</span><span class="at">Biden Votes</span><span class="st">`</span>, <span class="st">`</span><span class="at">Total Votes</span><span class="st">`</span>, <span class="st">`</span><span class="at">Fraction of Votes for Biden</span><span class="st">`</span>)</span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a><span class="co">#View(top_10_biden_fraction)</span></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a><span class="co">#Create a kable table of the top 10 counties</span></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(top_10_biden_fraction)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 17%">
<col style="width: 18%">
<col style="width: 14%">
<col style="width: 14%">
<col style="width: 34%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">County Name</th>
<th style="text-align: left;">State</th>
<th style="text-align: right;">Biden Votes</th>
<th style="text-align: right;">Total Votes</th>
<th style="text-align: right;">Fraction of Votes for Biden</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Oglala Lakota</td>
<td style="text-align: left;">South Dakota</td>
<td style="text-align: right;">2829</td>
<td style="text-align: right;">3200</td>
<td style="text-align: right;">0.884</td>
</tr>
<tr class="even">
<td style="text-align: left;">Jefferson</td>
<td style="text-align: left;">Mississippi</td>
<td style="text-align: right;">3327</td>
<td style="text-align: right;">3908</td>
<td style="text-align: right;">0.851</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Claiborne</td>
<td style="text-align: left;">Mississippi</td>
<td style="text-align: right;">3772</td>
<td style="text-align: right;">4449</td>
<td style="text-align: right;">0.848</td>
</tr>
<tr class="even">
<td style="text-align: left;">Macon</td>
<td style="text-align: left;">Alabama</td>
<td style="text-align: right;">7108</td>
<td style="text-align: right;">8723</td>
<td style="text-align: right;">0.815</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Greene</td>
<td style="text-align: left;">Alabama</td>
<td style="text-align: right;">3884</td>
<td style="text-align: right;">4775</td>
<td style="text-align: right;">0.813</td>
</tr>
<tr class="even">
<td style="text-align: left;">Holmes</td>
<td style="text-align: left;">Mississippi</td>
<td style="text-align: right;">6588</td>
<td style="text-align: right;">8115</td>
<td style="text-align: right;">0.812</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Durham</td>
<td style="text-align: left;">North Carolina</td>
<td style="text-align: right;">144688</td>
<td style="text-align: right;">179914</td>
<td style="text-align: right;">0.804</td>
</tr>
<tr class="even">
<td style="text-align: left;">Todd</td>
<td style="text-align: left;">South Dakota</td>
<td style="text-align: right;">1963</td>
<td style="text-align: right;">2539</td>
<td style="text-align: right;">0.773</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Noxubee</td>
<td style="text-align: left;">Mississippi</td>
<td style="text-align: right;">4040</td>
<td style="text-align: right;">5339</td>
<td style="text-align: right;">0.757</td>
</tr>
<tr class="even">
<td style="text-align: left;">Allendale</td>
<td style="text-align: left;">South Carolina</td>
<td style="text-align: right;">2718</td>
<td style="text-align: right;">3593</td>
<td style="text-align: right;">0.756</td>
</tr>
</tbody>
</table>
</div>
</div>
<p><br><br></p>
</section>
<section id="which-county-or-counties-had-the-largest-shift-towards-trump-in-absolute-terms-in-2024" class="level5">
<h5 class="anchored" data-anchor-id="which-county-or-counties-had-the-largest-shift-towards-trump-in-absolute-terms-in-2024">Which county or counties had the largest shift towards Trump (in absolute terms) in 2024?</h5>
<blockquote class="blockquote">
<p>The largest shift towards Trump is defined as the difference between the total votes cast for Trump in 2024 and the total votes cast for Trump in 2020. We will calculate this difference for each county and then find the top ten counties with the highest values.</p>
</blockquote>
<p><br><br></p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>largest_shift_trump <span class="ot">&lt;-</span> merged_data <span class="sc">|&gt;</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Trump Shift</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">as.numeric</span>(<span class="fu">gsub</span>(<span class="st">","</span>, <span class="st">""</span>, <span class="st">`</span><span class="at">Donald Trump (Republican) 2024</span><span class="st">`</span>)) <span class="sc">-</span> <span class="fu">as.numeric</span>(<span class="fu">gsub</span>(<span class="st">","</span>, <span class="st">""</span>, <span class="st">`</span><span class="at">Donald Trump (Republican) 2020</span><span class="st">`</span>))</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(<span class="st">`</span><span class="at">Trump Shift</span><span class="st">`</span>)) <span class="sc">|&gt;</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(<span class="st">`</span><span class="at">Trump Shift</span><span class="st">`</span>)) <span class="sc">|&gt;</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_head</span>(<span class="at">n =</span> <span class="dv">10</span>) <span class="sc">|&gt;</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="st">`</span><span class="at">County Name</span><span class="st">`</span>, State, <span class="st">`</span><span class="at">Trump Shift</span><span class="st">`</span>)</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a><span class="co">#View(largest_shift_trump)</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a><span class="co">#Create a kable table of largest shift towards Trump</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(largest_shift_trump)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">County Name</th>
<th style="text-align: left;">State</th>
<th style="text-align: right;">Trump Shift</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Bexar</td>
<td style="text-align: left;">Texas</td>
<td style="text-align: right;">28927</td>
</tr>
<tr class="even">
<td style="text-align: left;">Montgomery</td>
<td style="text-align: left;">Texas</td>
<td style="text-align: right;">28582</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Denton</td>
<td style="text-align: left;">Texas</td>
<td style="text-align: right;">28041</td>
</tr>
<tr class="even">
<td style="text-align: left;">Collin</td>
<td style="text-align: left;">Texas</td>
<td style="text-align: right;">27216</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Wayne</td>
<td style="text-align: left;">Michigan</td>
<td style="text-align: right;">24307</td>
</tr>
<tr class="even">
<td style="text-align: left;">Horry</td>
<td style="text-align: left;">South Carolina</td>
<td style="text-align: right;">22898</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Harris</td>
<td style="text-align: left;">Texas</td>
<td style="text-align: right;">22065</td>
</tr>
<tr class="even">
<td style="text-align: left;">Macomb</td>
<td style="text-align: left;">Michigan</td>
<td style="text-align: right;">20797</td>
</tr>
<tr class="odd">
<td style="text-align: left;">El Paso</td>
<td style="text-align: left;">Texas</td>
<td style="text-align: right;">20793</td>
</tr>
<tr class="even">
<td style="text-align: left;">Hidalgo</td>
<td style="text-align: left;">Texas</td>
<td style="text-align: right;">20233</td>
</tr>
</tbody>
</table>
</div>
</div>
<p><br><br></p>
</section>
<section id="which-state-had-the-largest-shift-towards-harris-or-smallest-shift-towards-trump-in-2024" class="level5">
<h5 class="anchored" data-anchor-id="which-state-had-the-largest-shift-towards-harris-or-smallest-shift-towards-trump-in-2024">Which state had the largest shift towards Harris (or smallest shift towards Trump) in 2024?</h5>
<blockquote class="blockquote">
<p>The largest shift towards Harris is defined as the difference between the total votes cast for Harris in 2024 and the total votes cast for Trump in 2020. We will calculate this difference for each state and then find the top ten states with the highest values.</p>
</blockquote>
<p><br><br></p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>state_trump_shift <span class="ot">&lt;-</span> merged_data <span class="sc">|&gt;</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>   <span class="fu">mutate</span>(</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">Trump_2024 =</span> <span class="fu">parse_number</span>(<span class="st">`</span><span class="at">Donald Trump (Republican) 2024</span><span class="st">`</span>),</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>     <span class="at">Trump_2020 =</span> <span class="fu">parse_number</span>(<span class="st">`</span><span class="at">Donald Trump (Republican) 2020</span><span class="st">`</span>)</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>   ) <span class="sc">|&gt;</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>   <span class="fu">group_by</span>(State) <span class="sc">|&gt;</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>   <span class="fu">summarise</span>(</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>     <span class="at">Total_Trump_2024 =</span> <span class="fu">sum</span>(Trump_2024, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>     <span class="at">Total_Trump_2020 =</span> <span class="fu">sum</span>(Trump_2020, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>     <span class="at">Trump_Vote_Shift =</span> Total_Trump_2024 <span class="sc">-</span> Total_Trump_2020</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>   ) <span class="sc">|&gt;</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>   <span class="fu">arrange</span>(<span class="fu">desc</span>(Trump_Vote_Shift))<span class="sc">|&gt;</span>  <span class="co"># Smallest shift first</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>   <span class="fu">slice_head</span>(<span class="at">n =</span> <span class="dv">10</span>) </span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a><span class="co">#View(state_trump_shift)</span></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a><span class="co">#Create a kable table of the small shift towards trump in 2024</span></span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(state_trump_shift)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">State</th>
<th style="text-align: right;">Total_Trump_2024</th>
<th style="text-align: right;">Total_Trump_2020</th>
<th style="text-align: right;">Trump_Vote_Shift</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Texas</td>
<td style="text-align: right;">6393597</td>
<td style="text-align: right;">5890347</td>
<td style="text-align: right;">503250</td>
</tr>
<tr class="even">
<td style="text-align: left;">Michigan</td>
<td style="text-align: right;">2816636</td>
<td style="text-align: right;">2649864</td>
<td style="text-align: right;">166772</td>
</tr>
<tr class="odd">
<td style="text-align: left;">North Carolina</td>
<td style="text-align: right;">2898423</td>
<td style="text-align: right;">2758775</td>
<td style="text-align: right;">139648</td>
</tr>
<tr class="even">
<td style="text-align: left;">South Carolina</td>
<td style="text-align: right;">1483747</td>
<td style="text-align: right;">1385103</td>
<td style="text-align: right;">98644</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Wisconsin</td>
<td style="text-align: right;">1697626</td>
<td style="text-align: right;">1610184</td>
<td style="text-align: right;">87442</td>
</tr>
<tr class="even">
<td style="text-align: left;">New Jersey</td>
<td style="text-align: right;">1968215</td>
<td style="text-align: right;">1883313</td>
<td style="text-align: right;">84902</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Massachusetts</td>
<td style="text-align: right;">1251303</td>
<td style="text-align: right;">1167202</td>
<td style="text-align: right;">84101</td>
</tr>
<tr class="even">
<td style="text-align: left;">Minnesota</td>
<td style="text-align: right;">1516432</td>
<td style="text-align: right;">1481537</td>
<td style="text-align: right;">34895</td>
</tr>
<tr class="odd">
<td style="text-align: left;">New Hampshire</td>
<td style="text-align: right;">395523</td>
<td style="text-align: right;">365660</td>
<td style="text-align: right;">29863</td>
</tr>
<tr class="even">
<td style="text-align: left;">Iowa</td>
<td style="text-align: right;">927019</td>
<td style="text-align: right;">897672</td>
<td style="text-align: right;">29347</td>
</tr>
</tbody>
</table>
</div>
</div>
<p><br><br></p>
</section>
<section id="what-is-the-largest-county-by-area-in-this-data-set" class="level5">
<h5 class="anchored" data-anchor-id="what-is-the-largest-county-by-area-in-this-data-set">What is the largest county, by area, in this data set?</h5>
<blockquote class="blockquote">
<p>The largest county is defined as the one with the largest area of land. We will filter the data to find the county with the maximum value in the <code>Area of Land</code> column.</p>
</blockquote>
<p><br><br></p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Find the largest county by area</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>largest_county_by_area <span class="ot">&lt;-</span> merged_data <span class="sc">|&gt;</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># create a new column for area of land</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="st">`</span><span class="at">Area of Land</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">as.numeric</span>(<span class="st">`</span><span class="at">Area of Land</span><span class="st">`</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># filter out counties with NA area</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(<span class="st">`</span><span class="at">Area of Land</span><span class="st">`</span>)) <span class="sc">|&gt;</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Order by area of land in descending order</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(<span class="st">`</span><span class="at">Area of Land</span><span class="st">`</span>)) <span class="sc">|&gt;</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Select the top county</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_head</span>(<span class="at">n =</span> <span class="dv">1</span>) <span class="sc">|&gt;</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Select relevant columns</span></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="st">`</span><span class="at">County Name</span><span class="st">`</span>, State, <span class="st">`</span><span class="at">Area of Land</span><span class="st">`</span>)</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert area from square meters to square miles</span></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>largest_county_by_area <span class="ot">&lt;-</span> largest_county_by_area <span class="sc">|&gt;</span></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="st">`</span><span class="at">Area (sq mi)</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">round</span>(<span class="st">`</span><span class="at">Area of Land</span><span class="st">`</span> <span class="sc">/</span> <span class="fl">2.59e+6</span>, <span class="dv">2</span>))</span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a><span class="co">#View(largest_county_by_area)</span></span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a><span class="co">#Create a kable table of the largest county by area</span></span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(largest_county_by_area)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">County Name</th>
<th style="text-align: left;">State</th>
<th style="text-align: right;">Area of Land</th>
<th style="text-align: right;">Area (sq mi)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Sweetwater</td>
<td style="text-align: left;">Wyoming</td>
<td style="text-align: right;">27005754360</td>
<td style="text-align: right;">10426.93</td>
</tr>
</tbody>
</table>
</div>
</div>
<p><br><br></p>
</section>
<section id="which-county-has-the-highest-voter-density-voters-per-unit-of-area-in-2020" class="level5">
<h5 class="anchored" data-anchor-id="which-county-has-the-highest-voter-density-voters-per-unit-of-area-in-2020">Which county has the highest voter density (voters per unit of area) in 2020?</h5>
<blockquote class="blockquote">
<p>Voter density is defined as the total number of votes cast in 2020 divided by the land area of the county. We will calculate this for each county and then find the county with the maximum value.</p>
</blockquote>
<blockquote class="blockquote">
<p>The highest voter denstiry in 2020 was in St.&nbsp;Louis, Missouri. The total votes was 536446 and the land area was 61.71937 square miles. The voter density was 8691.696 voters per square mile.</p>
</blockquote>
<p><br><br></p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>highest_voter_density_2020 <span class="ot">&lt;-</span> merged_data <span class="sc">|&gt;</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Total Votes 2020</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">parse_number</span>(<span class="st">`</span><span class="at">Total Votes Cast 2020</span><span class="st">`</span>),</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Land Area (sq mi)</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">as.numeric</span>(<span class="st">`</span><span class="at">Area of Land</span><span class="st">`</span>) <span class="sc">/</span> <span class="fl">2.59e+6</span>,  <span class="co"># Convert mÂ² to miÂ²</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Voter Density (2020)</span><span class="st">`</span> <span class="ot">=</span> <span class="st">`</span><span class="at">Total Votes 2020</span><span class="st">`</span> <span class="sc">/</span> <span class="st">`</span><span class="at">Land Area (sq mi)</span><span class="st">`</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(<span class="st">`</span><span class="at">Voter Density (2020)</span><span class="st">`</span>), <span class="st">`</span><span class="at">Land Area (sq mi)</span><span class="st">`</span> <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">|&gt;</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(<span class="st">`</span><span class="at">Voter Density (2020)</span><span class="st">`</span>)) <span class="sc">|&gt;</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_head</span>(<span class="at">n =</span> <span class="dv">1</span>) <span class="sc">|&gt;</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="st">`</span><span class="at">County Name</span><span class="st">`</span>, State, <span class="st">`</span><span class="at">Total Votes 2020</span><span class="st">`</span>, <span class="st">`</span><span class="at">Land Area (sq mi)</span><span class="st">`</span>, <span class="st">`</span><span class="at">Voter Density (2020)</span><span class="st">`</span>)</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a><span class="co">#View(highest_voter_density_2020)</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(highest_voter_density_2020)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="caption-top">
<colgroup>
<col style="width: 16%">
<col style="width: 8%">
<col style="width: 22%">
<col style="width: 24%">
<col style="width: 28%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">County Name</th>
<th style="text-align: left;">State</th>
<th style="text-align: right;">Total Votes 2020</th>
<th style="text-align: right;">Land Area (sq mi)</th>
<th style="text-align: right;">Voter Density (2020)</th>
</tr>
</thead>
<tbody>
</tbody>
</table>
</div>
</div>
<p><br><br></p>
</section>
<section id="which-county-had-the-largest-increase-in-voter-turnout-in-2024" class="level5">
<h5 class="anchored" data-anchor-id="which-county-had-the-largest-increase-in-voter-turnout-in-2024">Which county had the largest increase in voter turnout in 2024?</h5>
<blockquote class="blockquote">
<p>The largest increase in voter turnout is defined as the difference between the total votes cast in 2024 and the total votes cast in 2020. We will calculate this difference for each county and then find the county with the maximum value.</p>
</blockquote>
<p><br><br></p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>largest_turnout_increase_2024 <span class="ot">&lt;-</span> merged_data <span class="sc">|&gt;</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Total Votes 2024</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">parse_number</span>(<span class="st">`</span><span class="at">Total Votes Cast 2024</span><span class="st">`</span>),</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Total Votes 2020</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">parse_number</span>(<span class="st">`</span><span class="at">Total Votes Cast 2020</span><span class="st">`</span>)</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(<span class="st">`</span><span class="at">Total Votes 2024</span><span class="st">`</span>), <span class="sc">!</span><span class="fu">is.na</span>(<span class="st">`</span><span class="at">Total Votes 2020</span><span class="st">`</span>)) <span class="sc">|&gt;</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Turnout Increase</span><span class="st">`</span> <span class="ot">=</span> <span class="st">`</span><span class="at">Total Votes 2024</span><span class="st">`</span> <span class="sc">-</span> <span class="st">`</span><span class="at">Total Votes 2020</span><span class="st">`</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(<span class="st">`</span><span class="at">Turnout Increase</span><span class="st">`</span>)) <span class="sc">|&gt;</span></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_head</span>(<span class="at">n =</span> <span class="dv">1</span>) <span class="sc">|&gt;</span></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="st">`</span><span class="at">County Name</span><span class="st">`</span>, State, <span class="st">`</span><span class="at">Turnout Increase</span><span class="st">`</span>)</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a><span class="co">#View(largest_turnout_increase_2024)</span></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a><span class="co">#Create a kable table of the largest increase in voter turnout in 2024</span></span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(largest_turnout_increase_2024)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">County Name</th>
<th style="text-align: left;">State</th>
<th style="text-align: right;">Turnout Increase</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Montgomery</td>
<td style="text-align: left;">Texas</td>
<td style="text-align: right;">35715</td>
</tr>
</tbody>
</table>
</div>
</div>
<p><br><br></p>
</section>
</section>
<section id="reproduce-the-nyt-county-shift-figure-using-the-census-shapefiles-and-wikipedia-extracted-election-results." class="level3">
<h3 class="anchored" data-anchor-id="reproduce-the-nyt-county-shift-figure-using-the-census-shapefiles-and-wikipedia-extracted-election-results.">Reproduce the NYT County Shift figure using the Census shapefiles and Wikipedia-extracted election results.</h3>
<blockquote class="blockquote">
<p>Steps taken to reproduce the NYT shift figure: We computed the shift as a percentage of votes cast rightwards for each county. Then, we modified the geometry of the shapefiles to reposition Alaska and Hawaii. Next, we computed the centroid of each county. In additon, we added an arrow for each county, located at its centroid. Finally, plot the results using ggplot2 with the modified geometery.</p>
</blockquote>
<p><br><br></p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load required packages</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readr)</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tigris)</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(units)</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>shift_data <span class="ot">&lt;-</span> merged_data <span class="sc">|&gt;</span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">trump_2020 =</span> <span class="fu">parse_number</span>(<span class="st">`</span><span class="at">Donald Trump (Republican) 2020</span><span class="st">`</span>),</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">trump_2024 =</span> <span class="fu">parse_number</span>(<span class="st">`</span><span class="at">Donald Trump (Republican) 2024</span><span class="st">`</span>),</span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">total_2020 =</span> <span class="fu">parse_number</span>(<span class="st">`</span><span class="at">Total Votes Cast 2020</span><span class="st">`</span>),</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">total_2024 =</span> <span class="fu">parse_number</span>(<span class="st">`</span><span class="at">Total Votes Cast 2024</span><span class="st">`</span>),</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">pct_trump_2020 =</span> trump_2020 <span class="sc">/</span> total_2020,</span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">pct_trump_2024 =</span> trump_2024 <span class="sc">/</span> total_2024,</span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">shift =</span> pct_trump_2024 <span class="sc">-</span> pct_trump_2020</span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>shift_data <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(shift_data)  <span class="co"># Re-attach geometry and sf methods</span></span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>reposition_states <span class="ot">&lt;-</span> <span class="cf">function</span>(geo_data) {</span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Extract geometry</span></span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>  geo_data<span class="sc">$</span>geometry_orig <span class="ot">&lt;-</span> <span class="fu">st_geometry</span>(geo_data)</span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Reposition Hawaii</span></span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a>  geo_data<span class="sc">$</span>geometry[geo_data<span class="sc">$</span>State <span class="sc">==</span> <span class="st">"Hawaii"</span>] <span class="ot">&lt;-</span> </span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a>    geo_data<span class="sc">$</span>geometry_orig[geo_data<span class="sc">$</span>State <span class="sc">==</span> <span class="st">"Hawaii"</span>] <span class="sc">*</span> <span class="fl">0.35</span> <span class="sc">+</span> <span class="fu">c</span>(<span class="dv">40</span>, <span class="sc">-</span><span class="dv">15</span>)</span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Reposition Alaska</span></span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a>  geo_data<span class="sc">$</span>geometry[geo_data<span class="sc">$</span>State <span class="sc">==</span> <span class="st">"Alaska"</span>] <span class="ot">&lt;-</span> </span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a>    geo_data<span class="sc">$</span>geometry_orig[geo_data<span class="sc">$</span>State <span class="sc">==</span> <span class="st">"Alaska"</span>] <span class="sc">*</span> <span class="fl">0.35</span> <span class="sc">+</span> <span class="fu">c</span>(<span class="dv">55</span>, <span class="sc">-</span><span class="dv">15</span>)</span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb12-34"><a href="#cb12-34" aria-hidden="true" tabindex="-1"></a>  geo_data <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(geo_data)</span>
<span id="cb12-35"><a href="#cb12-35" aria-hidden="true" tabindex="-1"></a>  geo_data<span class="sc">$</span>geometry_orig <span class="ot">&lt;-</span> <span class="cn">NULL</span>  <span class="co"># Clean up if needed</span></span>
<span id="cb12-36"><a href="#cb12-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(geo_data)</span>
<span id="cb12-37"><a href="#cb12-37" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb12-38"><a href="#cb12-38" aria-hidden="true" tabindex="-1"></a>shifted_geometries <span class="ot">&lt;-</span> <span class="fu">reposition_states</span>(shift_data)</span>
<span id="cb12-39"><a href="#cb12-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-40"><a href="#cb12-40" aria-hidden="true" tabindex="-1"></a>shifted_geometries <span class="ot">&lt;-</span> shifted_geometries <span class="sc">|&gt;</span></span>
<span id="cb12-41"><a href="#cb12-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">centroid =</span> <span class="fu">st_centroid</span>(geometry)) <span class="sc">|&gt;</span></span>
<span id="cb12-42"><a href="#cb12-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb12-43"><a href="#cb12-43" aria-hidden="true" tabindex="-1"></a>    <span class="at">lon =</span> <span class="fu">st_coordinates</span>(centroid)[, <span class="dv">1</span>],</span>
<span id="cb12-44"><a href="#cb12-44" aria-hidden="true" tabindex="-1"></a>    <span class="at">lat =</span> <span class="fu">st_coordinates</span>(centroid)[, <span class="dv">2</span>]</span>
<span id="cb12-45"><a href="#cb12-45" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb12-46"><a href="#cb12-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-47"><a href="#cb12-47" aria-hidden="true" tabindex="-1"></a>arrow_data <span class="ot">&lt;-</span> shifted_geometries <span class="sc">|&gt;</span></span>
<span id="cb12-48"><a href="#cb12-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb12-49"><a href="#cb12-49" aria-hidden="true" tabindex="-1"></a>    <span class="at">dx =</span> shift <span class="sc">*</span> <span class="dv">5</span>,  <span class="co"># scale factor; adjust as needed</span></span>
<span id="cb12-50"><a href="#cb12-50" aria-hidden="true" tabindex="-1"></a>    <span class="at">dy =</span> <span class="dv">0</span>,</span>
<span id="cb12-51"><a href="#cb12-51" aria-hidden="true" tabindex="-1"></a>    <span class="at">xend =</span> lon <span class="sc">+</span> dx,</span>
<span id="cb12-52"><a href="#cb12-52" aria-hidden="true" tabindex="-1"></a>    <span class="at">yend =</span> lat <span class="sc">+</span> dy</span>
<span id="cb12-53"><a href="#cb12-53" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb12-54"><a href="#cb12-54" aria-hidden="true" tabindex="-1"></a><span class="co"># Add dx and dy based on shift</span></span>
<span id="cb12-55"><a href="#cb12-55" aria-hidden="true" tabindex="-1"></a>arrow_data <span class="ot">&lt;-</span> shifted_geometries <span class="sc">|&gt;</span></span>
<span id="cb12-56"><a href="#cb12-56" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(lon), <span class="sc">!</span><span class="fu">is.na</span>(lat), <span class="sc">!</span><span class="fu">is.na</span>(shift)) <span class="sc">|&gt;</span></span>
<span id="cb12-57"><a href="#cb12-57" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb12-58"><a href="#cb12-58" aria-hidden="true" tabindex="-1"></a>    <span class="at">dx =</span> shift <span class="sc">*</span> <span class="dv">5</span>,  <span class="co"># adjust scaling factor as needed for visibility</span></span>
<span id="cb12-59"><a href="#cb12-59" aria-hidden="true" tabindex="-1"></a>    <span class="at">dy =</span> <span class="dv">0</span>  <span class="co"># arrows go horizontally (right = red shift, left = blue shift)</span></span>
<span id="cb12-60"><a href="#cb12-60" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb12-61"><a href="#cb12-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-62"><a href="#cb12-62" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb12-63"><a href="#cb12-63" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> shifted_geometries, <span class="at">fill =</span> <span class="st">"gray95"</span>, <span class="at">color =</span> <span class="st">"white"</span>, <span class="at">size =</span> <span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb12-64"><a href="#cb12-64" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(</span>
<span id="cb12-65"><a href="#cb12-65" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> arrow_data,</span>
<span id="cb12-66"><a href="#cb12-66" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> lon, <span class="at">y =</span> lat, <span class="at">xend =</span> lon <span class="sc">+</span> dx, <span class="at">yend =</span> lat <span class="sc">+</span> dy, <span class="at">color =</span> shift),</span>
<span id="cb12-67"><a href="#cb12-67" aria-hidden="true" tabindex="-1"></a>    <span class="at">arrow =</span> <span class="fu">arrow</span>(<span class="at">length =</span> <span class="fu">unit</span>(<span class="fl">0.1</span>, <span class="st">"inches"</span>)),</span>
<span id="cb12-68"><a href="#cb12-68" aria-hidden="true" tabindex="-1"></a>    <span class="at">linewidth =</span> <span class="fl">0.3</span></span>
<span id="cb12-69"><a href="#cb12-69" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb12-70"><a href="#cb12-70" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_gradient2</span>(<span class="at">low =</span> <span class="st">"blue"</span>, <span class="at">mid =</span> <span class="st">"white"</span>, <span class="at">high =</span> <span class="st">"red"</span>, <span class="at">midpoint =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb12-71"><a href="#cb12-71" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb12-72"><a href="#cb12-72" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb12-73"><a href="#cb12-73" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Shift in Republican Vote Share (2020 â†’ 2024)"</span>,</span>
<span id="cb12-74"><a href="#cb12-74" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Arrows point rightward for increased Trump support, leftward for decreased"</span></span>
<span id="cb12-75"><a href="#cb12-75" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="mp04_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>


</section>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "î§‹";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/<Tiffany-B>\.github\.io\/STA9750-2025-SPRING\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




<script src="site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>